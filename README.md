# 🛡️ Система обнаружения контрафакта на маркетплейсе OZON

## 📋 Описание проекта
Комплексное ML-решение для автоматического выявления контрафактных товаров на платформе **OZON**, использующее ансамблевый подход с глубоким анализом текстовых описаний, метаданных товаров и поведенческих паттернов продавцов.

---

## 🏗️ Архитектура решения
Основные компоненты системы:

### 1) Модуль извлечения текстовых эмбеддингов (`extract_emb.py`)
- Использование трансформера **XLM-RoBERTa** для мультиязычных текстов  
- Fine-tuning модели на задаче классификации контрафакта  
- Извлечение семантических представлений описаний и названий товаров  

### 2) Модуль обработки метаданных (`feature_eng.py`)
- Создание **40+ инженерных признаков** из статистики продаж  
- **CatBoost encoding** категориальных переменных  
- Анализ поведенческих паттернов продавцов  

### 3) Модуль текстовых признаков (`extract_text_feature.py`)
- Детекция подозрительных ключевых слов  
- Анализ языковых пропорций и структуры текста  
- Извлечение статистических характеристик  

### 4) Ансамблевая модель (`pred.py`)
- **5 CatBoost моделей** с различными random seeds  
- Взвешенное усреднение предсказаний  
- Оптимизированный порог классификации: `0.617`  

### 5) Web-интерфейс (`web.py`)
- **FastAPI сервис** для загрузки и обработки данных  
- Автоматическая генерация результатов  

---

## 🚀 Установка и запуск

### Требования к системе
- Python 3.8+  
- CUDA-совместимая GPU *(рекомендуется для обработки эмбеддингов)*  
- Минимум **8GB RAM**  

### Установка зависимостей
```bash
# Основные библиотеки
pip install pandas numpy scikit-learn
pip install catboost lightgbm xgboost

# NLP и трансформеры
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
pip install transformers
pip install nltk beautifulsoup4
pip install pymorphy3 pymorphy3-dicts-ru

# Для кодирования
pip install category_encoders

# Web-сервис
pip install fastapi uvicorn python-multipart
📂 Структура проекта
text
Копировать код
project/
├── models/                 # Предобученные модели
│   ├── model1.pkl          # CatBoost модель (seed=42)
│   ├── model2.pkl          # CatBoost модель (seed=123)
│   ├── model3.pkl          # CatBoost модель (seed=456)
│   ├── model4.pkl          # CatBoost модель (seed=789)
│   ├── model5.pkl          # CatBoost модель (seed=2024)
│   ├── catboost_encoder.pkl  # Энкодер для категориальных признаков
│   └── PCA.pkl             # Редьюсер размерности для эмбеддингов
├── resources/              # Fine-tuned трансформер
│   ├── tokenizer/          # Токенизатор
│   ├── encoder/            # Энкодер модели
│   ├── classifier/         # Классификационная голова
│   ├── preprocessor.pkl    # Препроцессор текста
│   └── metadata.pkl
├── output/                 # Результаты предсказаний
├── workdir/in/             # Временные файлы
├── main.py                 # Основной пайплайн
├── extract_emb.py          # Работа с эмбеддингами
├── feature_eng.py          # Инженерия признаков
├── extract_text_feature.py # Текстовые фичи
├── pred.py                 # Ансамблевые предсказания
└── web.py                  # Web-сервис (FastAPI)
💻 Использование
1. Запуск через Web-интерфейс
bash
Копировать код
# Запуск сервера
uvicorn web:app --reload --host 0.0.0.0 --port 8000
Открой в браузере: 👉 http://localhost:8000

Загрузи CSV-файл через интерфейс

Скачай результат

2. Запуск из командной строки
python
Копировать код
from main import final

# Путь к тестовому файлу
test_file = "ml_ozon_counterfeit_test.csv"

# Запуск предсказаний
output_path = final(test_file)
print(f"Результаты сохранены в: {output_path}")
3. Обучение собственной модели
python
Копировать код
import extract_emb as ee

# Обучение и сохранение модели эмбеддингов
ee.train_and_save_model(
    df_train=train_data,
    save_dir="./my_model",
    fine_tune_epochs=3,
    fine_tune_lr=5e-5,
    fine_tune_sample_size=10000
)

# Использование обученной модели
embeddings = ee.inference_embeddings(
    df_test=test_data,
    model_dir="./my_model"
)
🔧 Конфигурация
Настройка порога классификации
В файле main.py:

python
Копировать код
# Изменить порог (по умолчанию 0.4)
submission = pd.DataFrame({
    'id': df_test['id'],
    'prediction': preds > 0.4  # <- настройка порога
})
Настройка ансамбля
В файле pred.py:

python
Копировать код
# Веса моделей (сумма должна быть 1.0)
weights = {
    'catboost_seed_42': 0.2,
    'catboost_seed_123': 0.2,
    'catboost_seed_456': 0.2,
    'catboost_seed_789': 0.2,
    'catboost_seed_2024': 0.2
}
🔍 Ключевые особенности решения
Мультимодальный подход: комбинирование текстовых, числовых и категориальных признаков

Fine-tuning на целевой задаче: адаптация языковой модели под специфику контрафакта

Робастность через ансамблирование: устойчивость к выбросам и шуму в данных

Оптимизация малых категорий: группировка редких брендов и категорий

Анализ временных трендов: учет динамики продаж и возвратов

📝 Лицензия
Проект разработан для внутреннего использования OZON.

👥 Команда разработки
Решение создано в рамках хакатона по обнаружению контрафакта на маркетплейсе OZON.
